<Window x:Class="uchat.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:uchat"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip"
        Title="Uchat" Height="700" Width="1200"
        WindowStartupLocation="CenterScreen">

    <Grid Background="{DynamicResource WindowBackgroundBrush}" MouseLeftButtonDown="Header_MouseLeftButtonDown">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="0.3*"/>
            <ColumnDefinition Width="0.7*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" CornerRadius="20" Background="{DynamicResource LeftPanelBrush}" Margin="10">
            <Grid>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="0.2*"/>
                    <ColumnDefinition Width="0.8*"/>
                </Grid.ColumnDefinitions>
                
                <Grid Grid.Column="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="2*"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" VerticalAlignment="Top" HorizontalAlignment="Left" Margin="5">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="5,5,0,0">
                            
                            <Button Style="{DynamicResource RoundButtonStyle}"
                                    Background="#FF5F56"
                                    Click="CloseButton_Click" 
                                    >
                                <Path Data="M192,64.34L179.66,52,128,103.66,76.34,52,64,64.34,115.66,116,64,167.66,76.34,180,128,128.34,179.66,180,192,167.66,140.34,116Z"
                                    Fill="Black" Stretch="Uniform" Width="8" Height="8"/>
                            </Button>
                            
                            <Button Style="{DynamicResource RoundButtonStyle}"
                                    Background="#FFBD2E" 
                                    Click="MinimizeButton_Click"
                                    Margin="1,0,0,0"
                                    >
                                <Path Data="M216,128a8,8,0,0,1-8,8H48a8,8,0,0,1,0-16H208A8,8,0,0,1,216,128Z"
                                    Fill="Black" Stretch="Uniform" Width="8" Height="8"/>
                            </Button>
                            
                            <Button Style="{DynamicResource RoundButtonStyle}"
                                    Background="#27C93F" 
                                    Click="MaximizeButton_Click"
                                    Margin="1,0,0,0"
                                    >
                                <Path Data="M208,48H48A16,16,0,0,0,32,64V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V64A16,16,0,0,0,208,48ZM208,208H48V64H208Z"
                                    Fill="Black" Stretch="Uniform" Width="8" Height="8"/>
                            </Button>
                        </StackPanel>
                        
                    </Grid>

                    <Grid Grid.Row="1" Background="Transparent" Margin="0,0,0,0" >
                        <StackPanel>
                            <RadioButton Style="{DynamicResource ToggleIconStyle}" GroupName="SideMenu" IsChecked="True">
                                <Path Data="M232.07,186.76a80,80,0,0,0-62.5-114.17A80,80,0,1,0,23.93,138.76l-7.27,24.71a16,16,0,0,0,19.87,19.87l24.71-7.27a80.39,80.39,0,0,0,25.18,7.35,80,80,0,0,0,108.34,40.65l24.71,7.27a16,16,0,0,0,19.87-19.86ZM62,159.5a8.28,8.28,0,0,0-2.26.32L32,168l8.17-27.76a8,8,0,0,0-.63-6,64,64,0,1,1,26.26,26.26A8,8,0,0,0,62,159.5Zm153.79,28.73L224,216l-27.76-8.17a8,8,0,0,0-6,.63,64.05,64.05,0,0,1-85.87-24.88A79.93,79.93,0,0,0,174.7,89.71a64,64,0,0,1,41.75,92.48A8,8,0,0,0,215.82,188.23Z"
                                    Fill="{Binding RelativeSource={RelativeSource AncestorType=RadioButton}, Path=Foreground}" Stretch="Uniform" Width="39" Height="36"/>
                            </RadioButton>
                            <RadioButton Style="{DynamicResource ToggleIconStyle}" GroupName="SideMenu" Margin="0,10,0,0">
                                <Path Data="M83.19,174.4a8,8,0,0,0,11.21-1.6,52,52,0,0,1,83.2,0,8,8,0,1,0,12.8-9.6A67.88,67.88,0,0,0,163,141.51a40,40,0,1,0-53.94,0A67.88,67.88,0,0,0,81.6,163.2,8,8,0,0,0,83.19,174.4ZM112,112a24,24,0,1,1,24,24A24,24,0,0,1,112,112Zm96-88H64A16,16,0,0,0,48,40V64H32a8,8,0,0,0,0,16H48v40H32a8,8,0,0,0,0,16H48v40H32a8,8,0,0,0,0,16H48v24a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V40A16,16,0,0,0,208,24Zm0,192H64V40H208Z"
                                    Fill="{Binding RelativeSource={RelativeSource AncestorType=RadioButton}, Path=Foreground}" Stretch="Uniform" Width="39" Height="39"/>
                            </RadioButton>
                            <RadioButton Style="{DynamicResource ToggleIconStyle}" GroupName="SideMenu" Margin="0,10,0,0">
                                <Path Data="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Zm88-29.84q.06-2.16,0-4.32l14.92-18.64a8,8,0,0,0,1.48-7.06,107.21,107.21,0,0,0-10.88-26.25,8,8,0,0,0-6-3.93l-23.72-2.64q-1.48-1.56-3-3L186,40.54a8,8,0,0,0-3.94-6,107.71,107.71,0,0,0-26.25-10.87,8,8,0,0,0-7.06,1.49L130.16,40Q128,40,125.84,40L107.2,25.11a8,8,0,0,0-7.06-1.48A107.6,107.6,0,0,0,73.89,34.51a8,8,0,0,0-3.93,6L67.32,64.27q-1.56,1.49-3,3L40.54,70a8,8,0,0,0-6,3.94,107.71,107.71,0,0,0-10.87,26.25,8,8,0,0,0,1.49,7.06L40,125.84Q40,128,40,130.16L25.11,148.8a8,8,0,0,0-1.48,7.06,107.21,107.21,0,0,0,10.88,26.25,8,8,0,0,0,6,3.93l23.72,2.64q1.49,1.56,3,3L70,215.46a8,8,0,0,0,3.94,6,107.71,107.71,0,0,0,26.25,10.87,8,8,0,0,0,7.06-1.49L125.84,216q2.16.06,4.32,0l18.64,14.92a8,8,0,0,0,7.06,1.48,107.21,107.21,0,0,0,26.25-10.88,8,8,0,0,0,3.93-6l2.64-23.72q1.56-1.48,3-3L215.46,186a8,8,0,0,0,6-3.94,107.71,107.71,0,0,0,10.87-26.25,8,8,0,0,0-1.49-7.06Zm-16.1-6.5a73.93,73.93,0,0,1,0,8.68,8,8,0,0,0,1.74,5.48l14.19,17.73a91.57,91.57,0,0,1-6.23,15L187,173.11a8,8,0,0,0-5.1,2.64,74.11,74.11,0,0,1-6.14,6.14,8,8,0,0,0-2.64,5.1l-2.51,22.58a91.32,91.32,0,0,1-15,6.23l-17.74-14.19a8,8,0,0,0-5-1.75h-.48a73.93,73.93,0,0,1-8.68,0,8,8,0,0,0-5.48,1.74L100.45,215.8a91.57,91.57,0,0,1-15-6.23L82.89,187a8,8,0,0,0-2.64-5.1,74.11,74.11,0,0,1-6.14-6.14,8,8,0,0,0-5.1-2.64L46.43,170.6a91.32,91.32,0,0,1-6.23-15l14.19-17.74a8,8,0,0,0,1.74-5.48,73.93,73.93,0,0,1,0-8.68,8,8,0,0,0-1.74-5.48L40.2,100.45a91.57,91.57,0,0,1,6.23-15L69,82.89a8,8,0,0,0,5.1-2.64,74.11,74.11,0,0,1,6.14-6.14A8,8,0,0,0,82.89,69L85.4,46.43a91.32,91.32,0,0,1,15-6.23l17.74,14.19a8,8,0,0,0,5.48,1.74,73.93,73.93,0,0,1,8.68,0,8,8,0,0,0,5.48-1.74L155.55,40.2a91.57,91.57,0,0,1,15,6.23L173.11,69a8,8,0,0,0,2.64,5.1,74.11,74.11,0,0,1,6.14,6.14,8,8,0,0,0,5.1,2.64l22.58,2.51a91.32,91.32,0,0,1,6.23,15l-14.19,17.74A8,8,0,0,0,199.87,123.66Z"
                                    Fill="{Binding RelativeSource={RelativeSource AncestorType=RadioButton}, Path=Foreground}" Stretch="Uniform" Width="39" Height="39"/>
                            </RadioButton>
                        </StackPanel>
                    </Grid>


                </Grid>

                <Grid Grid.Column="1">
                    <Border CornerRadius="20" Background="{DynamicResource ChatListBrush}" >    
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0"
                                    Text="Мои чаты" 
                                    FontSize="16" 
                                    FontWeight="Bold"
                                    Margin="10" 
                                    Foreground="#333333"/>

                            <Grid Grid.Row="1" Margin="10,0,10,10">
                                
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="0.8*"/>  <ColumnDefinition Width="0.2*"/>  </Grid.ColumnDefinitions>
                                
                                <TextBox x:Name="NewChatUsername" 
                                        Grid.Column="0"
                                        Height="30"
                                        Padding="5"
                                        VerticalContentAlignment="Center"
                                        FontSize="14"
                                        BorderBrush="#CCCCCC"
                                        BorderThickness="1"/>
                                
                                <Button x:Name="NewChatButton"
                                        Grid.Column="1"
                                        Content="+"
                                        Height="30"
                                        Margin="5,0,0,0"
                                        Background="#0078D4"
                                        Foreground="White"
                                        FontSize="14"
                                        FontWeight="Bold"
                                        BorderThickness="0"
                                        Click="NewChatButton_Click"/>
                                
                            </Grid>

                            <ListBox Grid.Row="2"
                                    x:Name="ChatsList"
                                    ItemsSource="{Binding ChatList, Mode=OneWay}"
                                    SelectedItem="{Binding SelectedChat, Mode=TwoWay}"
                                    BorderThickness="0"
                                    Background="Transparent"
                                    ScrollViewer.VerticalScrollBarVisibility="Auto">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="10,5" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <Ellipse Grid.Column="0" 
                                                        Width="40" 
                                                        Height="40" 
                                                        Margin="0,0,10,0"
                                                        VerticalAlignment="Center">
                                                    <Ellipse.Fill>
                                                        <SolidColorBrush Color="#0078D4"/>
                                                    </Ellipse.Fill>
                                                </Ellipse>

                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding DisplayName}" 
                                                            FontSize="14" 
                                                            FontWeight="Bold"
                                                            Foreground="#333333"/>
                                                    <TextBlock Text="{Binding LastMessage}"
                                                            FontSize="11"
                                                            Foreground="#666666"
                                                            TextTrimming="CharacterEllipsis"
                                                            MaxWidth="150"/>
                                                </StackPanel>

                                                <TextBlock Grid.Column="2" 
                                                        Text="{Binding LastMessageTime, StringFormat='HH:mm'}" 
                                                        FontSize="10"
                                                        Foreground="#999999"
                                                        VerticalAlignment="Top"
                                                        Margin="5,0,0,0"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                        <Setter Property="Padding" Value="0"/>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                            </ListBox>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
            </Grid>
        </Border>

        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" CornerRadius="5" Margin="5,10,10,10" Background="White">
                <ListBox x:Name="MessagesList" 
                         Background="Transparent"
                         BorderThickness="0"
                         ItemsSource="{Binding ChatMessages, Mode=OneWay}"
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="5,2">
                                <TextBlock FontSize="12" Foreground="Gray">
                                    <Run Text="["/>
                                    <Run Text="{Binding SentAt, StringFormat=HH:mm}"/>
                                    <Run Text="] "/>
                                    <Run Text="{Binding Username}" FontWeight="Bold"/>
                                </TextBlock>
                                <TextBlock Text="{Binding Content}" 
                                           FontSize="14" 
                                           Margin="20,0,0,0"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Border>

            <Border Grid.Row="1" Background="{DynamicResource MessageInputBrush}" Padding="10" CornerRadius="25" Margin="10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox x:Name="MessageInput" 
                             Grid.Column="0"
                             Height="35"
                             Margin="0,0,10,0"
                             Padding="10,0"
                             VerticalContentAlignment="Center"
                             FontSize="14"
                             KeyDown="MessageInput_KeyDown"
                             BorderBrush="#CCCCCC"
                             BorderThickness="1"/>

                    <Button x:Name="SendButton"
                            Grid.Column="1"
                            Content="Отправить"
                            Width="100"
                            Height="35"
                            Background="#0078D4"
                            Foreground="White"
                            FontSize="14"
                            FontWeight="Bold"
                            BorderThickness="0"
                            Click="SendButton_Click"/>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>